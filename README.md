# 股东回馈公告监控插件使用文档

## 一、插件简介
### 1.1 插件名称
`astrbot_plugin_ShareholderPerks`（股东回馈公告监控插件）

### 1.2 核心功能
- **定时监控**：每天12:00自动抓取指定URL的股东回馈相关公告，筛选当日最新信息
- **群组推送**：向管理员设置的目标群组推送公告（新公告则推送详情，无更新则提示"今日股东回馈消息无更新"）
- **手动查询**：支持群成员通过指令手动触发公告查询，实时获取最新公告信息
- **权限控制**：仅群组管理员可设置通知群组，保障操作安全性

### 1.3 适用场景
- 关注A股市场股东回馈类公告的群组（如投资交流群、企业股东群）
- 需要实时同步公告信息、避免遗漏重要通知的场景
- 希望自动化减少人工查询成本的群组管理需求

### 1.4 技术依赖
- 运行环境：支持Python 3.8+的`astrbot`框架
- 网络权限：机器人需具备访问互联网的权限（用于抓取公告数据）
- 框架依赖：`astrbot`核心组件（事件处理、权限控制、消息发送）

## 二、安装与加载
略

## 三、核心操作指南
### 3.1 管理员操作：设置通知群组
#### 功能说明
仅群组管理员可执行，用于指定接收每日公告推送的群组（插件会自动获取当前群组ID）

#### 操作步骤
1. 管理员进入目标群组（需接收公告的群聊）
2. 发送指令：`/set_shareholder_group`
3. 机器人回复确认信息，示例：
   ```
   ✅ 成功设置通知群组为当前群组 (ID: `123456789`)。每日公告将在此群组推送。
   ```

#### 注意事项
- 必须在**群组内**发送指令，私聊发送无效
- 仅群组管理员有权限执行，普通成员发送会被拒绝
- 若需更换通知群组，在新群组重新执行指令即可覆盖原有设置

### 3.2 普通成员操作：手动查询公告
#### 功能说明
所有群成员均可执行，用于手动触发公告查询，实时获取最新股东回馈公告信息

#### 操作步骤
1. 在任意聊天窗口（私聊/群组）发送指令：`/shareholderperks`
2. 机器人回复查询结果，分三种场景：
   - 场景1：当日有新公告
     ```
     🔍 **最新公告查询结果** 🔍

     **股票代码:** 688253
     **公告标题:** 英诺特：关于股东回馈活动的自愿性信息披露公告
     **发布时间:** 2025-11-18
     **查看链接:** [点击查看](https://www.cninfo.com.cn/new/disclosure/detail?orgId=9900048398&announcementId=1224808756&announcementTime=2025-11-18)
     ```
   - 场景2：当日无新公告
     ```
     🔍 **最新公告查询结果** 🔍

     **股票代码:** 688253
     **公告标题:** 英诺特：关于股东回馈活动的自愿性信息披露公告
     **发布时间:** 2025-11-17
     **查看链接:** [点击查看](https://www.cninfo.com.cn/new/disclosure/detail?orgId=9900048398&announcementId=1224808756&announcementTime=2025-11-17)
     ```
   - 场景3：获取公告失败
     ```
     ❌ 无法获取公告信息，请稍后重试。
     ```

### 3.3 自动推送机制
#### 触发时间
每天12:00自动执行公告检查并推送

#### 推送逻辑
1. 检查是否已设置通知群组（未设置则日志提示，不推送）
2. 抓取最新公告并判断是否为当日发布
3. 若为当日新公告：推送完整公告详情（股票代码、标题、发布时间、查看链接）
4. 若为非当日公告：推送"今日股东回馈消息无更新"
5. 若已推送过该公告：不重复推送（通过公告ID去重）

## 四、指令说明汇总
| 指令名称          | 权限要求 | 适用场景       | 功能描述                                  |
|-------------------|----------|----------------|-------------------------------------------|
| `/set_shareholder_group` | 管理员   | 群组内         | 设置接收每日公告推送的目标群组            |
| `/shareholderperks` | 所有成员 | 私聊/群组      | 手动查询最新股东回馈公告，返回详细结果    |

## 五、常见问题排查
### 5.1 插件加载失败
- 检查Python版本是否为3.8+
- 确认插件文件名称正确（`astrbot_plugin_ShareholderPerks.py`）
- 查看机器人日志，排查依赖缺失或代码语法错误

### 5.2 无法设置通知群组
- 确认发送者为群组管理员（非管理员无权限）
- 确认在群组内发送指令（私聊发送无效）
- 检查机器人是否有群组管理权限（可正常获取群组ID）

### 5.3 定时推送无消息
- 检查是否已设置通知群组（管理员执行`/set_shareholder_group`确认）
- 查看机器人日志，排查网络问题（无法访问公告URL）
- 确认当日是否有股东回馈相关公告（可通过`/shareholderperks`手动验证）

### 5.4 手动查询失败
- 检查机器人网络连接（是否能访问互联网）
- 确认公告URL是否有效（可手动访问链接验证）
- 等待片刻后重试（可能是临时网络波动）

## 六、注意事项
1. 公告数据来源于指定URL（`https://www.cninfo.com.cn/...`），若URL变更需修改插件代码中的`JSON_URL`变量
2. 机器人需保持在线状态，否则无法执行定时推送（离线期间会错过推送，次日恢复正常）
3. 公告链接有效期由数据提供方决定，若链接失效可通过`/shareholderperks`重新获取最新链接
4. 建议定期检查插件运行状态（通过机器人日志或手动查询指令），确保功能正常